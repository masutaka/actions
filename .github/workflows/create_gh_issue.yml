# Derived from https://github.com/route06/actions/blob/main/.github/workflows/create_gh_issue.yml
# Copyright (c) 2024 ROUTE06, Inc.
# Licensed under the MIT License.

# ## Summary
#
# Create GitHub Issue from the given arguments.

# ## Usage
#
# name: Create GitHub Issue
#
# on:
#   schedule:
#     # 毎週水曜 13:00 JST に実行
#     - cron: "0 4 * * wed"
#
# jobs:
#   create_issue:
#     uses: masutaka/actions/.github/workflows/create_gh_issue.yml@main
#     permissions:
#       contents: read
#       issues: write
#     with:
#       title: Sample Issue
#       description_template_path: _templates/sample_issue.md
#       assignees: alice,bob
#       labels: bug,wontfix

name: Create GitHub Issue

on:
  workflow_call:
    inputs:
      title:
        description: "作成する Issue のタイトル"
        required: true
        type: string
      description_template_path:
        description: "Issue の説明に利用するテンプレートファイルのパス"
        required: true
        type: string
      assignees:
        description: "（任意）Issue の Assignees; 例: alice,bob"
        type: string
      labels:
        description: "（任意）Issue の Labels; 例: bug,wontfix"
        type: string

jobs:
  create_issue:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    steps:
      - uses: actions/checkout@v6
      - name: Create a issue
        run: |
          gh issue create \
            --title "$ISSUE_TITLE" \
            --body-file "$ISSUE_DESCRIPTION" \
            --assignee "$ISSUE_ASSIGNEES" \
            --label "$ISSUE_LABELS"
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          ISSUE_TITLE: ${{ inputs.title }}
          ISSUE_DESCRIPTION: ${{ inputs.description_template_path }}
          ISSUE_ASSIGNEES: ${{ inputs.assignees }}
          ISSUE_LABELS: ${{ inputs.labels }}
